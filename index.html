<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聶.net | MOE!</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown-light.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <style>
        :root {
            --accent: #42b983; /* Halo Green */
            --text: #2c3e50;
            --meta: #95a5a6;
            --bg: #ffffff;
        }

        body {
            /* 字体栈：优先使用系统自带的高级衬线/无衬线体，加载最快 */
            font-family: -apple-system, "Noto Serif SC", "Songti SC", "Times New Roman", Serif; 
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.7;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 80px 20px 100px;
        }

        /* Header: 极简排版 */
        header { margin-bottom: 70px; }
        
        .brand {
            font-size: 1.8rem;
            font-weight: 700;
            color: #000;
            cursor: pointer;
            font-family: -apple-system, sans-serif; /* 标题用无衬线更现代 */
            letter-spacing: -1px;
        }

        .bio {
            margin-top: 10px;
            color: var(--meta);
            font-size: 0.95rem;
        }

        .nav { margin-top: 20px; display: flex; gap: 15px; }
        .nav a { color: #b2bec3; font-size: 1.1rem; transition: 0.3s; }
        .nav a:hover { color: var(--accent); }

        /* 列表设计：Higan 风格的核心 */
        .post-item {
            padding: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .post-meta {
            font-family: Consolas, Monaco, monospace;
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-bottom: 5px;
        }

        .post-title {
            font-size: 1.3rem;
            font-weight: 500;
            color: #2c3e50;
            text-decoration: none;
            position: relative;
            cursor: pointer;
            transition: color 0.2s;
        }

        /* 鼠标移上去，文字变色，左侧出现绿色指示条 */
        .post-title:hover {
            color: var(--accent);
        }
        
        /* 文章详情 */
        .markdown-body {
            font-family: "Georgia", "Noto Serif SC", serif; /* 正文衬线体 */
            font-size: 1.05rem;
            line-height: 1.9;
            color: #2c3e50;
        }
        .markdown-body a { color: var(--accent); text-decoration: none; border-bottom: 1px solid var(--accent); }
        .markdown-body h1, .markdown-body h2 { border-bottom: none; font-weight: 600; }
        
        /* 状态与辅助 */
        .hidden { display: none !important; }
        .back-btn { 
            cursor: pointer; 
            color: var(--meta); 
            font-size: 0.9rem; 
            margin-bottom: 30px; 
            display: inline-block;
        }
        .back-btn:hover { color: var(--accent); }

        /* 加载骨架屏 */
        .skeleton-line {
            height: 15px; background: #f0f2f5; margin-bottom: 10px; border-radius: 2px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>

<div class="container">
    <header id="header-area">
        <div class="brand" onclick="app.goHome()">聶.net</div>
        <div class="bio">
            KEEP IT SIMPLE, STUPID.<br>
            <span id="uptime" style="font-size:12px; opacity:0.6">运行中...</span>
        </div>
        <div class="nav">
            <a href="mailto:nkx080112@gmail.com"><i class="fa-solid fa-envelope"></i></a>
            <a href="https://github.com/3257085208"><i class="fa-brands fa-github"></i></a>
            <a href="https://status.nkx.moe"><i class="fa-solid fa-server"></i></a>
        </div>
    </header>

    <div id="list-view">
        <div id="posts-container">
            <div style="margin-top:30px">
                <div class="skeleton-line" style="width:30%"></div>
                <div class="skeleton-line" style="width:70%; height:24px"></div>
            </div>
        </div>
    </div>

    <div id="article-view" class="hidden">
        <div class="back-btn" onclick="app.goHome()">← 返回列表</div>
        <div id="article-content" class="markdown-body"></div>
    </div>
    
    <footer style="margin-top:80px; text-align:center; font-size:12px; color:#ddd; font-family:sans-serif;">
        &copy; 2026 NieKaiXiang | Static & Fast
    </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    const app = {
        posts: [],
        
        init() {
            window.addEventListener('hashchange', () => this.handleRoute());
            this.fetchData();
            this.calcUptime();
        },

        // 核心：直接请求 posts.json，速度极快
        async fetchData() {
            try {
                // 添加时间戳防止本地缓存过死，但在 CDN 层面我们会有策略
                const res = await fetch('./posts.json?t=' + new Date().getTime());
                if(!res.ok) throw new Error("Index missing");
                this.posts = await res.json();
                this.renderList();
                this.handleRoute();
            } catch (e) {
                document.getElementById('posts-container').innerHTML = `<p style="color:#e74c3c">无法加载列表，请稍后刷新。</p>`;
            }
        },

        renderList() {
            const container = document.getElementById('posts-container');
            container.innerHTML = '';
            
            this.posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post-item';
                div.innerHTML = `
                    <div class="post-meta">${post.date}</div>
                    <a class="post-title" href="#${post.file}">${post.title}</a>
                `;
                container.appendChild(div);
            });
        },

        async renderPost(filename) {
            const articleView = document.getElementById('article-view');
            const listView = document.getElementById('list-view');
            const content = document.getElementById('article-content');

            listView.classList.add('hidden');
            articleView.classList.remove('hidden');
            window.scrollTo(0,0);
            
            content.innerHTML = '<div class="skeleton-line" style="width:40%"></div><div class="skeleton-line" style="width:90%"></div><div class="skeleton-line" style="width:90%"></div>';

            try {
                // 请求 Markdown 文件
                const res = await fetch(`./posts/${filename}`);
                if(!res.ok) throw new Error("404");
                const text = await res.text();
                content.innerHTML = marked.parse(text);
            } catch (e) {
                content.innerHTML = "文章加载失败，文件可能不存在。";
            }
        },

        handleRoute() {
            const hash = window.location.hash.slice(1);
            if(hash) {
                this.renderPost(hash);
            } else {
                document.getElementById('article-view').classList.add('hidden');
                document.getElementById('list-view').classList.remove('hidden');
                document.title = "聶.net | MOE!";
            }
        },

        goHome() { window.location.hash = ''; },
        
        calcUptime() {
            const start = new Date("2025-01-01").getTime();
            const days = Math.floor((new Date().getTime() - start) / 86400000);
            document.getElementById('uptime').innerText = `已运行 ${days} 天`;
        }
    };

    app.init();
</script>
</body>
</html>
